{
  "hash": "0b55de41b12058c6a50d20b76640baa0",
  "result": {
    "markdown": "---\ntitle: \"Modeling state funding policy proposals in R\"\ndate: \"July 25, 2023\"\nformat:\n  revealjs:\n    chalkboard: true\nexecute:\n  freeze: auto\n  echo: false\n---\n\n\n# Homework Review\n\n## Overview of Homework\n\n# Small Group Discussion\n\n## In small groups, answer the questions below.\n\n::: columns\n::: {.column width=\"50%\"}\n-   If you had a magic wand, what's on thing you would change about your state's education funding formula?\n-   What are your advocacy goals around education finance (e.g. legislative change, coalition building, educate the public, etc.)?\n:::\n\n::: {.column width=\"50%\" height=\"40%\"}\n![](https://cdn-s3.touchofmodern.com/products/000/916/544/20bc386f2df2abc98ac74b2bc1981150_large.jpg?1513797797)\n:::\n:::\n\n# Steps to building your state's funding formula and modeling changes in R\n\n## Staying organized with a systematic approach will pay off as you build a funding model in R\n\nConstructing a version of your state's current funding system in R can be complicated, but following a few clear steps will help you in the long run:\n\n1. Start with an outline of your formula's business rules\n2. In your script, hard-code key dollar amounts, weights, and ratios\n3. Build code for your state's base amount (or equivalent)\n4. Build code for your state's weighted funding (or equivalent)\n5. Build code for direct funding streams\n6. Calculate per-pupil amounts for comparison\n\n## Step 1: Create an outline of the funding formula in a word document or in R {.smaller}\n\n-   Create business rules that will help with guiding the structure of the code and comments\n-   Allows everyone to be on the same page about the data that is needed and how the various funding streams are calculated\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# funding formula table building --------------------\n\n  # 1. BASE COST COMPONENT ------------\n\n  # | 1a) teacher base ------------\n\n  # | 1b) student support base ----------\n  \n  # | 1c) district leadership and accountability component of base cost ----\n  \n  # | 1d) building leader cost -------------\n\n  # | 1e) Athletics co-curricular costs -----------\n\n  # | 1f) local capacity percentage -----------------\n\n  # | 1g) local capacity amount  --------------\n\n  # 2. TARGETED ASSISTANCE ------------------\n\n  # 3. SPECIAL ED, ELL, CTE, DPIA CATEGORICALS ----------------------------\n \n  # 4. GIFTED FUNDING --------\n\n  # 5. SUPPLEMENTAL TARGETED ASSSISTANCE -----------\n\n  # 6. TRANSPORTATION ---------------\n\n  # 7. CREATE TOTALS -----------\n```\n:::\n\n\n## Step 2: Hard code in the per-pupil base, weights, categoricals, and cut-offs\n\n-   Hardcoding in the variables protects against potential changes.\n    -   If a value changes, you just need to change the hard coded variable rather than going through the formula and changing all of the numbers associated with that variable.\n-   Needed for building run the impact of potential changes to weights, per-pupil base, and direct funding.\n\n## Step 2: Example below is from Ohio's state education funding formula (1/2) {.smaller}\n\n::: columns\n::: {.column width=\"40%\" height=\"40%\"}\n**Greenbook - Teacher Base Cost**\n\n![](images/oh-greenbook-base.png){fig-align=\"center\" width=\"356\"}\n:::\n\n::: {.column width=\"40%\" height=\"40%\"}\n**R Code - Teacher Base Cost**\n\nNote: I didn't hard code in \\$9,953 for benefits because it's 16% of the average teacher salary. Now, if the avg_teacher_salary changes, I don't have to change the variable.\n\n![](images/oh-base-hardcode.png){fig-align=\"center\" width=\"271\"}\n:::\n:::\n\n## Step 2: Example below is from Ohio's state education funding formula (2/2)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ohio Special education weights \n\nsped_1_weight <- 0.2435 # speech and language impairments and intellectual disabilities \nsped_2_weight <- 0.6179 # specific learning disabilities and other health impaired \n#(minor) & developmental delay (preschool only)\nsped_3_weight <- 1.4845 # deafness, emotional disturbance \nsped_4_weight <- 1.9812 # visual impairments, other health impaired (other) \nsped_5_weight <- 2.6830 # multiple disabilities (other than deaf-blind), \n#orthopedic impairments, deaf-blindness\nsped_6_weight <- 3.9554 # autism and traumatic brain injury \n\n# Ohio English Learner weights \n\nel_1_weight <- .2104 # Students identified as EL and enrolled in schools in the \n#US for 180 days or less\nel_2_weight <- .1577 # Students identified as EL and enrolled in schools in the \n#US for more than 180 days until the student achieves EL proficiency \nel_3_weight <- .1053 # Students who achieved the proficient score on the EL exam \n```\n:::\n\n\n## Step 3: Build the base amount in R\n\nThe base amount will be the largest cost in a student-based formula. It reflects the cost of educating a single student and should be uniform across the state. However, sometimes base costs can be more complicated and involved multiple components.\n\n![](images/wsf-illustration.png){fig-align=\"center\"}\n\n## Minnesota Example: Calculate the base amount in R\n\nCalculating Minnesota's per-pupil base amount is very straight forward:\n\n-   **Step 1**: Hard coded the per-pupil base amount\n-   **Step 2**: Created the Minnesota data frame and created the base by multiplying the per-pupil base amount by total ADM\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1\n# This is the per-pupil base amount that is used for calculating the total base and then the weights \npp_mn_base <- 6863\n\n# Step 2\n# Calculate the base amount\nmn_base_funding_sch24 <- formula_data24 |>\n         # total base = school's total adm * 6863\n  mutate(mn_base_total = total_adm * pp_mn_base)\n```\n:::\n\n\n## Ohio Example: Calculate the base amount for charter schools in R\n\nCalculating Ohio's base amount is more complicated...\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Building the formula data \ncharter_funding_formula <- charter_formula_data |>\n  \n  # 1. BASE COST COMPONENT ------------\n# | 1a) teacher base ------------\n\nmutate(teacher_base_cost = avg_teacher_salary + avg_health_insurance + (avg_teacher_salary * retirement_multiplier), \n       gr_k_classroom_teachers = adm_k_fy22 / base_k_ratio, \n       gr_1_3_classroom_teachers = adm_1_3_fy22 / base_1_3_ratio,\n       gr_4_8_classroom_teachers = adm_4_8_fy22 / base_4_8_ratio,\n       gr_9_12_classroom_teachers = adm_hs_fy2 / base_hs_ratio,\n       cte_classroom_teachers = adm_cte_fy22 / base_cte_ratio,\n       # sum total classroom teachers and cost\n       total_classroom_teachers = gr_k_classroom_teachers + \n         gr_1_3_classroom_teachers + \n         gr_4_8_classroom_teachers + \n         gr_9_12_classroom_teachers + \n         cte_classroom_teachers,\n       total_classroom_teachers_base_cost = total_classroom_teachers * \n         teacher_base_cost, \n       # calculate total special teachers and cost \n       # Community schools do not have a position minimum (6) for special education teachers \n       # like with traditional districts. Rather, it's the ADM divided by the ratio. \n       # When I was looking at the FY22 June CS Foundation Payment it used a different \n       # salary for special education teachers \n       total_special_teachers = total_adm_fy22/base_special_ratio,  \n       total_special_teachers_base_cost = total_special_teachers * teacher_base_cost, \n       # calculate sub costs\n       sub_teacher_base_cost = (total_classroom_teachers + total_special_teachers) * \n         ((sub_teacher_daily_rate * retirement_multiplier) + sub_teacher_daily_rate) * sub_teacher_days,\n       # calculate pd costs\n       teacher_pd_base_cost = (total_classroom_teachers + total_special_teachers) * \n         ((teacher_base_cost - avg_health_insurance) / 180) *\n         teacher_pd_days,\n       # subtotal: teacher base cost \n       total_teacher_component_base_cost = total_classroom_teachers_base_cost + \n         total_special_teachers_base_cost + \n         sub_teacher_base_cost + \n         teacher_pd_base_cost,\n       teacher_base_cost_formula = ((total_classroom_teachers + total_special_teachers) * teacher_base_cost) + \n         teacher_pd_base_cost + sub_teacher_base_cost) |>\n  \n  # | 1b) student support base ----------\n\n# The student support base cost is a straight allocation for community schools ($874)\nmutate(total_student_support_base_cost = total_adm_fy22 * student_support_allocation) |>\n  \n  # | 1c) district leadership and accountability component of base cost --------\n\n# The district leadership and accountability base cost is a straight allocation for community schools ($503)\nmutate(total_district_leadership_base_cost = total_adm_fy22 * district_leadership_allocation) |>\n  \n  #  | 1d) building leader cost -------------\n\n# The building leadership and operations base cost is a straight allocation for community schools ($1469)\nmutate(total_building_leadership_base_cost = total_adm_fy22 * building_leadership_allocation) |>\n  \n  # | 1e) Athletics co-curricular costs -----------\n# The athletics base cost is a straight allocation for community schools ($163)\nmutate(athletics_base_cost = ifelse(is.na(athletic_eligible), 0,\n                                    case_when(athletic_eligible == 1 ~ total_adm_fy22 * athletics_allocation,\n                                              athletic_eligible == 0 ~ 0))) |> \n\n  # | Aggregate base cost subtotal -----------\nmutate(aggregate_base_cost = total_teacher_component_base_cost + \n         total_student_support_base_cost + \n         total_district_leadership_base_cost + \n         total_building_leadership_base_cost + \n         athletics_base_cost,\n       aggregate_base_cost_pp = aggregate_base_cost / total_adm_fy22) \n```\n:::\n\n\n## Step 4: Build the weighted funding amounts\n\nThe weights are additional funding for student groups with additional learning needs. Some formulas also have district-level adjustments to account for community conditions that affect costs, like sparsity or concentrated poverty.\n\n![](images/wsf-illustration.png){fig-align=\"center\"}\n\n## Ohio Example: Building weighted funding for special education\n\nSometimes the weights can be straight forward. In Ohio, the special education is calculated as follows:\n\n**special education category ADM x applicable weight x statewide average base cost per pupil**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate the categorical funding amounts\n  # special education amounts \n        # total amount = sped category * statewide avg. pp base * applicable weight \n  mutate(sped_cat1_amt = swd_cat1_fy22 * statewide_base_pp_cost * sped_1_weight,\n         sped_cat2_amt = swd_cat2_fy22 * statewide_base_pp_cost * sped_2_weight,\n         sped_cat3_amt = swd_cat3_fy22 * statewide_base_pp_cost * sped_3_weight,\n         sped_cat4_amt = swd_cat4_fy22 * statewide_base_pp_cost * sped_4_weight,\n         sped_cat5_amt = swd_cat5_fy22 * statewide_base_pp_cost * sped_5_weight,\n         sped_cat6_amt = swd_cat6_fy22 * statewide_base_pp_cost * sped_6_weight) \n```\n:::\n\n\n## Minnesota Example: Building weighted funding for economically disadvantaged students\n\nSometimes the weight calculations are more complicated!\n\n![](images/mn-compensatory-rev.png){fig-align=\"center\"}\n\n\n## Don't panic! Take it one step at a time!\n\n![](https://www.thesmallbusinesssite.co.za/wp-content/uploads/2020/03/Panic-730x495.jpg){fig-align=\"center\"}\n\n## Minnesota Example: Compensatory Revenue Calculation in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Build the compensatory revenue formula with the mn_joined spreadsheet and graph it\n\n## Calculate the compensatory revenue per school and rebuild the model\ncomprev_schools_model <- mn_comprev_final |>\n  # Step 1: Split the reduced price student count in half because \n  # they are only worth .5 in the compensatory revenue formula \n  mutate(comprev_reduced_count = reduced_lunch * .5, \n         \n  # Step 2:Add together the .5 reduced price count to the free \n  # count to get the corrected frpl number for the compensatory revenue formula \n         comprev_frpl_reduced_total = comprev_reduced_count + free_lunch, \n  \n  #This is the new frpl % with .5 reduced price count\n         comprev_frpl_reduced_pct = comprev_frpl_reduced_total/enroll, \n  \n  #Step 3: Divide by the weight factor by .8\n         comprev_weight_factor_step = comprev_frpl_reduced_pct/.8, \n  \n### I'm keeping this interim step so that I can track it\n        #Replace anything above 1 with 1 because of the formula \n         comprev_weight_factor = ifelse(comprev_weight_factor_step > 1, \n                                        1, comprev_weight_factor_step), \n\n         # determine the compensatory revenue pupil unit count \n         comprev_comp_pupil_unit = comprev_frpl_reduced_total*comprev_weight_factor*.6,\n\n# determine the amount of money that the school generates\n         comprev_total = comprev_comp_pupil_unit * 5599, \n\n# per-pupil amount for the school that generates the funds    \n         comprev_pp = comprev_total/frpl_total) \n```\n:::\n\n\n## Step 5: Build in direct funding {.smaller}\n\nOperates outside of the formula and does not go through the per-pupil base. Direct funding offers students additional educational opportunities by supporting programs that offer students learning opportunities beyond everyday classroom instruction.\n\n-   Math and reading programs\n-   College and career readiness\n-   Social-emotional learning\n\n![](images/tn-direct-funding.png){fig-align=\"center\"}\n\n## Alabama Example: Direct Funding\n\nJust like with building weights, the direct funding can be straight forward.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Alabama Classroom Instructional Support Funding -----\nstudent_materials <- 900 # multiply this by the total instructional unit\ntechnology <- 500 # multiply this by the total instructional unit\nlibrary_enhancement <- 157.72 # multiply this by the total instructional unit\nprofessional_development <- 100 # multiply this by the total instructional unit\ntextbooks <- 75 # multiply this by total student ADM \n## Alabama Classroom Instructional Support Funding  calculations ------\nal_direct_funding <- formula_data24 |> \n  # student materials funding \n   mutate(student_materials_amount = student_materials * total_instructional_units, \n          \n  # technology funding\n         technology_amount = technology * total_instructional_units,  \n  \n  # library enhancement funding \n         library_enhacement_amount = library_enhancement * total_instructional_units,  \n  \n  # professional development funding \n         professional_development_amount = professional_development * total_instructional_units,  \n  # textbook funding \n         textbooks_amount = textbooks * total_adm, \n  \n  # total classroom instructional support \n        textbooks_amount =  student_materials_amount + technology_amount + \n                            library_enhancement_amount + professional_development_amount \n                            + textbooks_amount)\n```\n:::\n\n\n## Ohio Example: Direct Funding\n\nOther times, the direct funding calculations can be more complicated.\n\n![](images/dpia-summary.png){fig-align=\"center\"}\n\n## Don't panic! One step at a time!\n\n![](https://sd.keepcalms.com/i/keep-calm-and-code-on-821.png){fig-align=\"center\"}\n\n## Ohio Example: Direct Funding, more detail\n\nYou may need to consult multiple sets of documentation to uncover precise business rules for your state's current funding system.\n\n![](images/dpia-detail.png){fig-align=\"center\"}\n\n## Ohio Example: Calculating the Disadvantaged Pupil Impact Aid (1/2)\n\n**Step 1**: Find the calculation for the economically disadvantaged index:\n\n*District's economically disadvantaged index = The square of (District's economically disadvantaged percentage/Statewide economically disadvantaged percentage)*\n\n**Step 2:** Translate that into R code\n\n![](images/dpia-r-calc.png){fig-align=\"center\"}\n\n## Ohio Example: Calculating the Disadvantaged Pupil Impact Aid (2/2)\n\n**Step 3**: Build out the Disadvantaged Pupil Impact Aid exception for e-schools in R\n\n![](images/dpia-e-school.png){fig-align=\"center\"}\n\n## Step 6: Calculate the state total for each district and the per-pupil amount\n\n-   To calculate the total, add together the base cost, the weights, and the direct funding\n-   To calculate the per-pupil amount, divide the total funding by the total ADM\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate Ohio charter funding total amount \ncharter_state_funding <- charter_funding_formula |>\n  summarise(total_charter_adm = sum(total_adm_fy22, na.rm = T),\n            state_base_cost = sum(aggregate_base_cost, na.rm = T),\n            state_dpia_cost = sum(econ_disadv_amt, na.rm = T),\n            total_econ_dis_adm = sum(econ_dis_adm_fy22, na.rm = T),\n            state_el_cost = sum(ell_funding, na.rm = T),\n            state_sped_cost = sum(special_ed_funding, narm = T),\n            state_cte_cost = sum(cte_funding, na.rm = T)) |>\n  mutate(state_base_pp = state_base_cost/total_charter_adm, \n         econ_dis_pp = state_dpia_cost/total_econ_dis_adm,\n         econ_dis_pp_second = state_dpia_cost/total_charter_adm)\n```\n:::\n\n\n## Why are per-pupil amounts important?\n\nPer-pupil amounts are important to identify if funding formulas are equitably distributing funds\n\n![](images/per-pupil-before-after.png){fig-align=\"center\"}\n\n# Small group activity\n\n## Building a funding formula in R\n\nYour team has been tasked with building your state's newly passed funding formula in R. Using the information in the table, hard code in the base, weights, and direct funding and then write out the R code that would be used to model the formula. Be sure to include headings and comments!!!\n\n![](https://www.memesmonkey.com/images/memesmonkey/1c/1c00a56795e6846cd7a57d9a63294be1.jpeg){fig-align=\"center\"}\n\n# Homework\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}