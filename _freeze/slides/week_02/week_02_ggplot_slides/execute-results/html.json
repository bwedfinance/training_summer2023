{
  "hash": "950614a9a0ab03bda1d5ed30856ce583",
  "result": {
    "markdown": "---\ntitle: \"Basic Data Analysis and Visualization in R\"\ndate: \"June 13, 2023\"\nformat: \n  revealjs:\n    chalkboard: true\nexecute:\n  freeze: auto\n  echo: false\n---\n\n\n## Agenda\n\n-   Homework review (15 min)\n\n-   Exploring local revenue through `edbuildr` and the `tidyverse` (60 min)\n\n-   Break (10 min)\n\n-   Visualizing local revenue data with `ggplot2` (30 min)\n\n-   Homework assignment (5 min)\n\n# Homework Review\n\n## Solving a common problem with the homework\n\nGreat job, overall! One universal comment is that we want to avoid hard coding values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Several people took an extra step and hard coded in the value\n\nmedian(sd_data$MHI, na.rm = T)\nmhi_median <- 57199\n\n# You can streamline the code like this: \n\nmhi_median <- median(sd_data$MHI, na.rm = T)\n\n# We avoid hard coding variables because if you update the data set and the 'MHI' \n# variable updates, then 'mhi_median' will automatically update. \n\n# find the median value of median property value (MPV) and store the result in a variable called `mpv_median`\n\nmpv_median <- median(sd_data$MPV, na.rm = T)\n\n# find the median value of state revenue per pupil (SRPP) and store the result in a variable called `srpp_median`\n\nsrpp_median <- median(sd_data$SRPP, na.rm = T)\n\n# find the median value of local revenue per pupil (LRPP) and store the result in a variable called `lrpp_median`\n\nlrpp_median <- median(sd_data$LRPP, na.rm = T)\n```\n:::\n\n\n# How do local taxes affect school finance equity?\n\n## How Property Taxes Fund Schools\n\nA large share of funding for public schools (44.9%) is generated by taxes at the local level. Property taxes are the most common source of local tax revenue for public schools in large part because they provide a stable revenue stream compared to taxes on sales or income. These taxes can be set by counties, towns, or school boards, depending on state policy.\n\nProperty taxes are typically collected based on two variables:\n\n-   Assessed value of property\n-   Property tax rate, sometimes called the \"mill\" rate.\n\n::: callout\n**How do property taxes produce education finance inequities?**\n\nSchool districts generate revenue from the local property tax associated with property located within districts' geographic boundaries. When school districts have significantly different levels of property wealth producing those tax revenues compared to one another, a massive barrier to equitable educational finance results.\n:::\n\n:::aside\n\nSource: [NCES](https://nces.ed.gov/programs/digest/d22/tables/dt22_235.10.asp)\n\n:::\n\n## Defining key property tax terms\n\n**What does \"assessed value of property\" mean?**\n\nThe assessed value of a property is the dollar value used by a local government to determine how much a particular property is worth. The assessed value of a property may not always match the market value. Some local governments use an assessment rate to translate the market value of a property into taxable value.\n\n**What is the \"property tax rate\" or \"mill rate?**\n\nThe mill rate is the number of dollars per \\$1,000 in assessed value that property owners will owe each year. The mill rate multiplied by assessed value equals local property tax bills.\n\nIn some instances, state policy directly shapes or limits property taxes. Some states include caps on how much mill rates can grow each year; other states limit the growth in the assessed values of properties over time.\n\n## Making Local School Funding More Equitable {.smaller}\n\nThe way school district boundaries are drawn and the way school funding formulas account for differences in tax capacity among districts can reflect, amplify, or mitigate property wealth inequality. State policymakers can also implement policies that directly address local funding inequity by constraining runaway local taxation by wealthier districts, compensating for local revenue differences with state funds, and/or redistributing some of those funds. Some examples include:\n\n-   **Capping local revenue**: State policymakers can set a limit on the amount of per-pupil revenue local communities can generate for their public schools.\n-   **Supplementing local tax revenues in lower-wealth districts**: States can provide additional funding to lower-wealth districts who choose to set a higher tax rate to ensure they get the same revenue for their tax effort that wealthier districts get.\n-   **Implementing redistributive mechanisms for exceeding local revenue caps**: If communities wish to generate more revenue for their local school system above the cap, policymakers can set a rule that for every additional dollar generated above the cap, another dollar must be allocated to a state fund for schools in lower-wealth communities.\n-   **Enacting a statewide property tax**: Moving from many locally collected taxes to a single, statewide property tax is the most direct way to address property wealth inequities among school districts. Vermont is the only state to implement a state-level property tax system for financing education.\n\n## Does your state set a local tax floor or ceiling? \n\n| **State**    | **Description**                                                                                                  |\n|:------------|:-------------------------------------------------------|\n| Alabama      | Alabama sets a floor for local property tax rates, as well as a ceiling, above which voter approval is required. |\n| Delaware     | None.                                                                                                            |\n| Georgia      | Georgia sets a floor for local property tax rates, as well as a level above which voter approval is required.    |\n| Michigan     | Michigan sets a ceiling for local property tax rates.                                                            |\n| Mississippi  | Mississippi sets a floor and a ceiling for local property tax rates.                                             |\n| New York     | None.                                                                                                            |\n| Pennsylvania | None.                                                                                                            |\n\n## Questions for advocates\n\n-   How do property wealth per pupil and mill rates vary by school district in your state?\n-   Do school districts in your state have non-property tax local revenue sources?\n-   Does state policy work to compensate for differences in local revenue capacity among districts? If so, how?\n-   What policies might help improve the equity of local funding in your state?\n\n# Introduction to the `tidyverse`\n\n## R is a functional programming language - most of what you will do in R is work with functions\n\nA function:\n\n-   Takes a specified input\n-   Performs an operation\n-   Returns an output\n\nFunctions are helpful tools to reduce repetition in typing and improves your code's consistency, reliability and readability.\n\n## The tidyverse is a powerful collection of R packages that work well together {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\n::: columns\n-   The most popular packages in the R community are past of what is called the \"tidyverse,\" which includes packages like `ggplot2`, `tidyr`, `stringr`, `tibble`, and `purrr`.\n\n-   `Tidyverse` packages are built to work together. Every `tidyverse` package contains functions that can manipulate or visualize data that lives in data frames.\n\n-   Most functions in the `tidyverse` require a data frame (R's version of a table) as the first argument in each function. The functions can be \"chained\" together with other functions.\n\n-   We will explore the `tidyverse` by looking at EdBuild's FY2019 education data compiled from the F33 survey, SAIPE, EDGE, and CCD. The `edbuildr` package provides access to clean district data on funding, student demographics, and wealth.\n:::\n:::\n\n::: {.column width=\"50%\"}\n![](https://education.rstudio.com/blog/2020/07/teaching-the-tidyverse-in-2020-part-1-getting-started/img/tidyverse-packages.png)\n:::\n:::\n\n## To read EdBuild's finance data into our working environment we will use the masterpull() function\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(edbuildr)\n\nedbuild_fin_fy19 <- masterpull(data_year = 2019, data_type = \"fin\")\n```\n:::\n\n\nThis code will load the `edbuildr` package and then download a clean dataframe from EdBuild's server and store it as a variable called `edbuild_fin_fy19`.\n\nThere are three options for the `data_type` argument:\n\n-   \"geo\": only includes districts with geographic boundaries (no charter/special school districts) that meet EdBuild's criteria for fiscal analysis\n-   \"fin\": includes all districts that meet EdBuild's criteria for fiscal analysis\n-   \"full\": includes all districts -- TO BE USED WITH CAUTION\n\n## The dplyr() package provides many functions to manipulate your data frames' columns and rows\n\nThe functions you'll most frequently use from the dplyr packages are:\n\n-   `select()`: names columns to keep from a data frame\n-   `rename()`: name columns to keep from a data frame\n-   `filter()`: remove rows that do not meet the condition in the logical statement from the output\n-   `mutate()`: create a new column that will be added to the end of your data frame.\n\n## A special operator called a \"pipe\" will allow you to chain several functions together\n\n-   In R, the pipe operator is a vertical bar and a greater-than sign: `|>`\n\n-   Instead of \"nesting\" the results of one function inside of another, the pipe allows you to execute the same command in a more human-readable order.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# example of \"nesting\" the result of one function inside another function\ndf1 <- select(filter(raw_df, enroll > 10000), dist_id, dist_name, enroll, rev_pp)\n\n# example of using the \"pipe\" to produce the same result as above\n# read the pipe as \"and then\" to understand what's being done to your data\ndf2 <- raw_df |> # start with raw_df AND THEN\n  filter(enroll > 10000) |> # filter for enrollment > 10,000 AND THEN\n  select(dist_id, dist_name, enroll, rev_pp) # select only these columns\n```\n:::\n\n\n# Iterative exploratory analysis\n\n## LIVE CODING EXAMPLE: exploring_the_tidyverse.R\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load ----------\n\noptions(scipen = 999)\n\nlibrary(tidyverse)\nlibrary(edbuildr)\n\n# Krista likes to denote which spreadsheet is raw for transparency \ndist_fy19_raw <- masterpull(data_type = \"geo\")\n\n# filter Minnesota data and clean -----\n\n# filter, rename, and mutate data for Minnesota \nmn_ed_data <- dist_fy19_raw |>\n  filter(State == \"Minnesota\") |>\n  rename(district = NAME,\n         county = County,\n         enroll = ENROLL, \n         total_local_rev = LR,\n         total_state_rev = SR,\n         total_state_local_rev = SLR, \n         urbanicity = dUrbanicity,\n         operational_schools = dOperational_schools, \n         district_type = dType, \n         white_enroll = dWhite, \n         sped_enroll = dIEP, \n         ell_enroll = dLEP, \n         econ_dis_enroll = StPov,\n         bipoc_pct = pctNonwhite, \n         pov_pct = StPovRate,\n         median_house_income = MHI, \n         median_prop_value = MPV) |>\n  mutate(bipoc_enroll = enroll - white_enroll,\n         ell_pct = ell_enroll/enroll, \n         sped_pct = sped_enroll/enroll, \n         local_rev_pp = total_local_rev/enroll,\n         state_rev_pp = total_state_rev/enroll,\n         local_state_rev_pp = total_state_local_rev/enroll) |>\n  select(district, county, enroll, local_rev_pp, state_rev_pp, local_state_rev_pp, \n         total_local_rev, total_state_rev, total_state_local_rev, urbanicity, \n         operational_schools, district_type, pov_pct, bipoc_pct, ell_pct, sped_pct)\n```\n:::\n\n\n# Visual exploratory analysis\n\n## Summarizing columns can be helpful, but it can hide nuance in your data that can be better seen via plotting\n\nThe `ggplot2` package is the most widely-used data visualization approach in the R ecosystem.\n\n-   Plots in `ggplot2` are created by starting with your data, then building up layers\n-   Once your specify your data, you can add layers of \"geoms\" to create your plot\n-   Today we will use `geom_histogram()` and `geom_point()`\n\n# Iterating your way to beauty with ggplot2 using Minnesota data\n\n## Step 1: Create a basic plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# first minnesota plot \nggplot(mn_ed_data, aes(x = pov_pct, y = local_rev_pp)) +\n  geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 8 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n## Step 2: Address missing values\n\nWe need to figure out what's going on with our missing values before we go any further!\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# investigate missing values \nmn_na_dist <- mn_ed_data |>\n  filter(is.na(local_rev_pp) | is.na(pov_pct)) |>\n  arrange(district_type) \n\nview(mn_na_dist)\n```\n:::\n\n\nThe missing data makes sense. All eight of the rows don't have any available data.\n\n## Step 3: Clean up formatting of chart elements (1/5)\n\nNow that we understand our missing data, we can create an updated dataframe and re-plot our newly cleaned data.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# create tidy df\nmn_ed_clean <- mn_ed_data |>\n  filter(!is.na(local_rev_pp), \n         !is.na(pov_pct))\n\nview(mn_ed_clean)\n\n# Drop the 2 districts that have no enrollment\nmn_ed_clean <- mn_ed_clean |>\n  filter(enroll > 0)\n\n# first minnesota plot w/ clean data\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n## Step 3: Clean up formatting of chart elements (2/5)\n\nWe see some overlap in the points. Reducing the opacity of the points can be accomplished by setting the `alpha` parameter in geom_point() to a value less than 1. Setting it to .5 will make data points 50% translucent.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# reduce opacity of points\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp)) +\n  geom_point(alpha = .5)\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n## Step 3: Clean up formatting of chart elements (3/5)\n\nLet's take care of some formatting issues.\n\nOur axes don't look great - the decimals ought to be percentages and the vertical axis represents dollars. Here, the `scales` package provides some help.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# format axes \nlibrary(scales)\n\n# format the x and y axes\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp)) +\n  geom_point(alpha = .5) + \n# make sure you have the `scales` package loaded!\n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar())\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n## Step 3: Clean up formatting of chart elements (4/5)\n\nNext, we should add some labels to our axes that make sense, along with a title for our plot and a caption that details our data sources.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# add data labels \nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp)) +\n  geom_point(alpha = .5) + \n# make sure you have the `scales` package loaded!\n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) + \n    labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\") \n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n## Step 3: Clean up formatting of chart elements (5/5)\n\nThemes can be used to change the appearance of elements in your plot. There are many stock options, but I prefer `theme_bw()` for its clean appearance and helpful and unobtrusive grid lines.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# change theme\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp)) +\n  geom_point(alpha = .5) + \n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) + \n    labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n# Break\n\n## Step 4: Add a new layer of data\n\nNow that we have a decent-looking graph, let's add in a new data element to vary point size by enrollment.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# add size element \nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll)) +\n  geom_point(alpha = .5) + \n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) +\n    labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n## Step 5: Tidy up formatting (1/2)\n\nAdding a new variable for size creates a legend. We need to tidy the legend's labels and the title.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# clean up the legend\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll)) +\n  geom_point(alpha = .5) + \n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) + \n  # change legend label formatting\n  scale_size(labels = comma) +\n    labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\",\n       # add nice label for size element\n  size = \"Enrollment\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n## Step 5: Tidy up formatting (2/2)\n\nWe can also adjust some paramenters to allow for more visual contrast in size. By default, `ggplot2` will adjust points' radii based on the size variable. Using area is a more visually honest way to represent the data, so let's make that change.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# create more contrast in size\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll)) +\n  geom_point(alpha = .5) + \n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) + \n  # change size scaling to vary by area, not radius + change max size\n  scale_size_area(labels = label_comma(), max_size = 10) + \n  labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\",\n       # add nice label for size element\n       size = \"Enrollment\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n\n## Step 6: Repeat steps 4-5 as needed (1/5)\n\nAdding color can be helpful. Let's add color based on urbanicity.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# add in color based on urbanicity\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll,\n                        color = urbanicity)) +\n  geom_point(alpha = .5) + \n  scale_x_continuous(labels = percent_format(accuracy = 1)) +\n  scale_size_area(labels = comma, max_size = 10) + \n  labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local  Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\",\n       size = \"Enrollment\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n\n## Step 6: Repeat steps 4-5 as needed (2/5)\n\nThat doesn't look great. Let's use some more functions from the `tidyverse` to clean up the data a little more to reduce 11 urbanicity levels to four, then tidy up the legend label.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# clean up the unicorn vomit\nmn_ed_clean <- mn_ed_clean |>\n  mutate(urbanicity = fct_collapse(as.factor(urbanicity),\n                                   City = c(\"11-City: Large\", \n                                            \"12-City: Mid-size\",\n                                            \"13-City: Small\"),\n                                   Suburb = c(\"21-Suburb: Large\",\n                                              \"22-Suburb: Mid-size\",\n                                             \"23-Suburb: Small\"),\n                                   Town = c(\"31-Town: Fringe\",\n                                            \"32-Town: Distant\",\n                                            \"33-Town: Remote\"),\n                                   Rural = c(\"41-Rural: Fringe\",\n                                             \"42-Rural: Distant\",\n                                             \"43-Rural: Remote\")))\n\n# better colors and tidy legend label\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll,\n                        color = urbanicity)) +\n  geom_point(alpha = .5) + \n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) +\n  scale_size_area(labels = label_comma(), max_size = 10) +  \n  labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local  Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\",\n       size = \"Enrollment\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n\n## Step 6: Repeat steps 4-5 as needed (3/5)\n\nWe can and should adjust the colors used. R recognizes some pretty funky color names, which can be found in this helpful cheat sheet.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# adjust colors manually\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll,\n                        color = urbanicity)) +\n  geom_point(alpha = .5) + \n    # create manual color palette\n  # color names pulled from a pdf y'all should bookmark\n  # http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf\n  scale_color_manual(values = c(\"tomato3\", \"steelblue2\",\n                                \"seagreen3\", \"orchid1\")) +\n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) +\n  scale_size_area(labels = label_comma(), max_size = 10) + \n  labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local  Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\",\n       size = \"Enrollment\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n## Step 6: Repeat steps 4-5 as needed (4/5)\n\nWe should strive to make our analyses as accessible as possible. The `viridis` package includes some color palettes that are friendly for folks with color blindness, which affects 5-10 percent of the US population.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# use colors better for visual impairments\nlibrary(viridis)\n# adjust colors manually\n\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll,\n                        color = urbanicity)) +\n  geom_point(alpha = .5) + \n  # use a colorblind-friendly palette\n  scale_color_viridis_d() +\n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) +\n  scale_size_area(labels = label_comma(), max_size = 10) + \n  labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local  Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\",\n       size = \"Enrollment\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n\n\n## Step 6: Repeat steps 4-5 as needed (5/5)\n\nLet's adjust the range of colors used to exclude that hard-to-see yellow.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# that yellow is hard to see - let's adjust the range\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll,\n                        color = urbanicity)) +\n  geom_point(alpha = .5) + \n  # adjust color range\n  scale_color_viridis_d(end = .8) +\n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) +\n  scale_size_area(labels = label_comma(), max_size = 10) + \n  labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local  Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\",\n       size = \"Enrollment\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n\n## Step 7: Replace a layer of data\n\nSometimes color isn't the answer - let's try facets instead.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# use facets instead of color\nggplot(mn_ed_clean, aes(x = pov_pct, y = local_rev_pp, size = enroll)) +\n  geom_point(alpha = .5) + \n  # add facet by urbanicity\n  facet_wrap(~urbanicity) +\n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_dollar()) +\n  scale_size_area(labels = label_comma(), max_size = 10) + \n  labs(x = \"Student Poverty Rate\", y = \"Local Per-Pupil Revenue\",\n       title = \"Local  Per-Pupil Revenue by Student Povert Rate in Minnesota School Districts\",\n       caption = \"Source: Edbuild Data, 2019\",\n       size = \"Enrollment\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-20-1.png){width=960}\n:::\n:::\n\n\n# Using histograms to compare state and local revenue\n\n## Use Edbuildr data to create state summaries\n\nSummarize the state level data and calculate the median for enrollment, number of schools, median household income, median property value, and more.\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# summarise ------------\n\n# create a state summary dataframe\nstate_summary <- dist_fy19_raw |> \n  group_by(State) |> \n  summarise(enroll_med = median(ENROLL, na.rm = T),\n            n_schools_med = median(dOperational_schools, na.rm = T),\n            nonwhite_pct_med = median(pctNonwhite, na.rm = T),\n            st_pov_rate_med = median(StPovRate, na.rm = T),\n            sd_area_med = median(sd_area, na.rm = T),\n            student_per_sq_mile_med = median(student_per_sq_mile, na.rm = T),\n            mhi_med = median(MHI, na.rm = T),\n            mpv_med = median(MPV, na.rm = T),\n            state_loc_rev_pp_med = median(SLRPP, na.rm = T))\n```\n:::\n\n\n## Create histograms (1/3)\n\nUse a histogram to visualize the distribution of median property values across states.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# histogram of median property value\nggplot(data = state_summary) +\n  geom_histogram(mapping = aes(x = mpv_med), binwidth = 40000)\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n\n## Create histograms (2/3)\n\nUse a histogram to visualize the distribution of median household income across states.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# histogram of median household income\nggplot(data = state_summary) +\n  geom_histogram(mapping = aes(x = mhi_med), binwidth = 3000)\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-23-1.png){width=960}\n:::\n:::\n\n\n## Create histograms (3/3)\n\nUse a histogram to visualize the distribution of state and local per-pupil funding across states.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# histogram of state + local pp rev\nggplot(data = state_summary) +\n  geom_histogram(mapping = aes(x = state_loc_rev_pp_med), binwidth = 2000)\n```\n\n::: {.cell-output-display}\n![](week_02_ggplot_slides_files/figure-revealjs/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\n# Homework\n\n## This week's assignment {.smaller}\n\n**Reading assignment**\n\n-   [ ] [***How Do Local Taxes Affect School Finance Equity?***](https://bellwether.org/wp-content/uploads/2021/10/Bellwether_SplittingBill_06-LocalTaxesAndFinanceEquity_Final.pdf)\n\n**Coding task**\n\nUse `edbuildr` data and `tidyverse` functions to:\n\n-   [ ] Create a dataframe that includes `edbuilder` data from your state\n\n-   [ ] Plot histograms shows the distributions of property wealth, income, and per-pupil revenue across school districts\n\n-   [ ] Develop two scatterplots that illustrate important relationships in your state's school finance landscape by working within these options:\n\n    -   X-axis variable options: median household income (`MHI`), median property value (`MPV`), and student poverty rate (`StPovRate`) as your x-axis variables\n\n    -   Y-axis variable options: state per-pupil revenue (`SRPP`), local per-pupil revenue (`LRPP`), and combined state and local per-pupil revenue (`SLRPP`)\n\n    -   Size variable: Enrollment (`ENROLL`)\n\n    -   Color variables: Urbanicity (`dUrbanicity`), median household income (`MHI`), median property value (`MPV`), and student poverty rate (`StPovRate`)\n\n    -   Use the formatting techniques covered in class to create nice axis and legend labels and add titles and captions to your plots.\n",
    "supporting": [
      "week_02_ggplot_slides_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}