<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.306">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-07-25">

<title>School Finance Equity Training, Summer 2023 - Modeling state funding policy proposals in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Modeling state funding policy proposals in R</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/primary_one-color_reverse.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#homework-review" id="toc-homework-review" class="nav-link active" data-scroll-target="#homework-review">Homework Review</a>
  <ul class="collapse">
  <li><a href="#overview-of-homework" id="toc-overview-of-homework" class="nav-link" data-scroll-target="#overview-of-homework">Overview of Homework</a></li>
  </ul></li>
  <li><a href="#small-group-discussion" id="toc-small-group-discussion" class="nav-link" data-scroll-target="#small-group-discussion">Small Group Discussion</a>
  <ul class="collapse">
  <li><a href="#in-small-groups-answer-the-questions-below." id="toc-in-small-groups-answer-the-questions-below." class="nav-link" data-scroll-target="#in-small-groups-answer-the-questions-below.">In small groups, answer the questions below.</a></li>
  </ul></li>
  <li><a href="#steps-to-building-your-states-funding-formula-and-modeling-changes-in-r" id="toc-steps-to-building-your-states-funding-formula-and-modeling-changes-in-r" class="nav-link" data-scroll-target="#steps-to-building-your-states-funding-formula-and-modeling-changes-in-r">Steps to building your state’s funding formula and modeling changes in R</a>
  <ul class="collapse">
  <li><a href="#staying-organized-with-a-systematic-approach-will-pay-off-as-you-build-a-funding-model-in-r" id="toc-staying-organized-with-a-systematic-approach-will-pay-off-as-you-build-a-funding-model-in-r" class="nav-link" data-scroll-target="#staying-organized-with-a-systematic-approach-will-pay-off-as-you-build-a-funding-model-in-r">Staying organized with a systematic approach will pay off as you build a funding model in R</a></li>
  <li><a href="#step-1-create-an-outline-of-the-funding-formula-in-a-word-document-or-in-r" id="toc-step-1-create-an-outline-of-the-funding-formula-in-a-word-document-or-in-r" class="nav-link" data-scroll-target="#step-1-create-an-outline-of-the-funding-formula-in-a-word-document-or-in-r">Step 1: Create an outline of the funding formula in a word document or in R</a></li>
  <li><a href="#step-2-hard-code-in-the-per-pupil-base-weights-categoricals-and-cut-offs" id="toc-step-2-hard-code-in-the-per-pupil-base-weights-categoricals-and-cut-offs" class="nav-link" data-scroll-target="#step-2-hard-code-in-the-per-pupil-base-weights-categoricals-and-cut-offs">Step 2: Hard code in the per-pupil base, weights, categoricals, and cut-offs</a></li>
  <li><a href="#step-2-example-below-is-from-ohios-state-education-funding-formula-12" id="toc-step-2-example-below-is-from-ohios-state-education-funding-formula-12" class="nav-link" data-scroll-target="#step-2-example-below-is-from-ohios-state-education-funding-formula-12">Step 2: Example below is from Ohio’s state education funding formula (1/2)</a></li>
  <li><a href="#step-2-example-below-is-from-ohios-state-education-funding-formula-22" id="toc-step-2-example-below-is-from-ohios-state-education-funding-formula-22" class="nav-link" data-scroll-target="#step-2-example-below-is-from-ohios-state-education-funding-formula-22">Step 2: Example below is from Ohio’s state education funding formula (2/2)</a></li>
  <li><a href="#step-3-build-the-base-amount-in-r" id="toc-step-3-build-the-base-amount-in-r" class="nav-link" data-scroll-target="#step-3-build-the-base-amount-in-r">Step 3: Build the base amount in R</a></li>
  <li><a href="#minnesota-example-calculate-the-base-amount-in-r" id="toc-minnesota-example-calculate-the-base-amount-in-r" class="nav-link" data-scroll-target="#minnesota-example-calculate-the-base-amount-in-r">Minnesota Example: Calculate the base amount in R</a></li>
  <li><a href="#ohio-example-calculate-the-base-amount-for-charter-schools-in-r" id="toc-ohio-example-calculate-the-base-amount-for-charter-schools-in-r" class="nav-link" data-scroll-target="#ohio-example-calculate-the-base-amount-for-charter-schools-in-r">Ohio Example: Calculate the base amount for charter schools in R</a></li>
  <li><a href="#step-4-build-the-weighted-funding-amounts" id="toc-step-4-build-the-weighted-funding-amounts" class="nav-link" data-scroll-target="#step-4-build-the-weighted-funding-amounts">Step 4: Build the weighted funding amounts</a></li>
  <li><a href="#ohio-example-building-weighted-funding-for-special-education" id="toc-ohio-example-building-weighted-funding-for-special-education" class="nav-link" data-scroll-target="#ohio-example-building-weighted-funding-for-special-education">Ohio Example: Building weighted funding for special education</a></li>
  <li><a href="#minnesota-example-building-weighted-funding-for-economically-disadvantaged-students" id="toc-minnesota-example-building-weighted-funding-for-economically-disadvantaged-students" class="nav-link" data-scroll-target="#minnesota-example-building-weighted-funding-for-economically-disadvantaged-students">Minnesota Example: Building weighted funding for economically disadvantaged students</a></li>
  <li><a href="#dont-panic-take-it-one-step-at-a-time" id="toc-dont-panic-take-it-one-step-at-a-time" class="nav-link" data-scroll-target="#dont-panic-take-it-one-step-at-a-time">Don’t panic! Take it one step at a time!</a></li>
  <li><a href="#minnesota-example-compensatory-revenue-calculation-in-r" id="toc-minnesota-example-compensatory-revenue-calculation-in-r" class="nav-link" data-scroll-target="#minnesota-example-compensatory-revenue-calculation-in-r">Minnesota Example: Compensatory Revenue Calculation in R</a></li>
  <li><a href="#step-5-build-in-direct-funding" id="toc-step-5-build-in-direct-funding" class="nav-link" data-scroll-target="#step-5-build-in-direct-funding">Step 5: Build in direct funding</a></li>
  <li><a href="#alabama-example-direct-funding" id="toc-alabama-example-direct-funding" class="nav-link" data-scroll-target="#alabama-example-direct-funding">Alabama Example: Direct Funding</a></li>
  <li><a href="#ohio-example-direct-funding" id="toc-ohio-example-direct-funding" class="nav-link" data-scroll-target="#ohio-example-direct-funding">Ohio Example: Direct Funding</a></li>
  <li><a href="#dont-panic-one-step-at-a-time" id="toc-dont-panic-one-step-at-a-time" class="nav-link" data-scroll-target="#dont-panic-one-step-at-a-time">Don’t panic! One step at a time!</a></li>
  <li><a href="#ohio-example-direct-funding-more-detail" id="toc-ohio-example-direct-funding-more-detail" class="nav-link" data-scroll-target="#ohio-example-direct-funding-more-detail">Ohio Example: Direct Funding, more detail</a></li>
  <li><a href="#ohio-example-calculating-the-disadvantaged-pupil-impact-aid-12" id="toc-ohio-example-calculating-the-disadvantaged-pupil-impact-aid-12" class="nav-link" data-scroll-target="#ohio-example-calculating-the-disadvantaged-pupil-impact-aid-12">Ohio Example: Calculating the Disadvantaged Pupil Impact Aid (1/2)</a></li>
  <li><a href="#ohio-example-calculating-the-disadvantaged-pupil-impact-aid-22" id="toc-ohio-example-calculating-the-disadvantaged-pupil-impact-aid-22" class="nav-link" data-scroll-target="#ohio-example-calculating-the-disadvantaged-pupil-impact-aid-22">Ohio Example: Calculating the Disadvantaged Pupil Impact Aid (2/2)</a></li>
  <li><a href="#step-6-calculate-the-state-total-for-each-district-and-the-per-pupil-amount" id="toc-step-6-calculate-the-state-total-for-each-district-and-the-per-pupil-amount" class="nav-link" data-scroll-target="#step-6-calculate-the-state-total-for-each-district-and-the-per-pupil-amount">Step 6: Calculate the state total for each district and the per-pupil amount</a></li>
  <li><a href="#why-are-per-pupil-amounts-important" id="toc-why-are-per-pupil-amounts-important" class="nav-link" data-scroll-target="#why-are-per-pupil-amounts-important">Why are per-pupil amounts important?</a></li>
  </ul></li>
  <li><a href="#small-group-activity" id="toc-small-group-activity" class="nav-link" data-scroll-target="#small-group-activity">Small group activity</a>
  <ul class="collapse">
  <li><a href="#building-a-funding-formula-in-r" id="toc-building-a-funding-formula-in-r" class="nav-link" data-scroll-target="#building-a-funding-formula-in-r">Building a funding formula in R</a></li>
  </ul></li>
  <li><a href="#homework" id="toc-homework" class="nav-link" data-scroll-target="#homework">Homework</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week_07_slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modeling state funding policy proposals in R</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 25, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="homework-review" class="level1">
<h1>Homework Review</h1>
<section id="overview-of-homework" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-homework">Overview of Homework</h2>
<ul>
<li>Any technical issues?</li>
<li>Did your maps confirm what you already knew, provide new insights, or a little of both?</li>
</ul>
</section>
</section>
<section id="small-group-discussion" class="level1">
<h1>Small Group Discussion</h1>
<section id="in-small-groups-answer-the-questions-below." class="level2">
<h2 class="anchored" data-anchor-id="in-small-groups-answer-the-questions-below.">In small groups, answer the questions below.</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>If you had a magic wand, what’s on thing you would change about your state’s education funding formula?</li>
<li>What are your advocacy goals around education finance (e.g.&nbsp;legislative change, coalition building, educate the public, etc.)?</li>
</ul>
</div><div class="column" height="40%" style="width:50%;">
<p><img src="https://cdn-s3.touchofmodern.com/products/000/916/544/20bc386f2df2abc98ac74b2bc1981150_large.jpg?1513797797" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="steps-to-building-your-states-funding-formula-and-modeling-changes-in-r" class="level1">
<h1>Steps to building your state’s funding formula and modeling changes in R</h1>
<section id="staying-organized-with-a-systematic-approach-will-pay-off-as-you-build-a-funding-model-in-r" class="level2">
<h2 class="anchored" data-anchor-id="staying-organized-with-a-systematic-approach-will-pay-off-as-you-build-a-funding-model-in-r">Staying organized with a systematic approach will pay off as you build a funding model in R</h2>
<p>Constructing a version of your state’s current funding system in R can be complicated, but following a few clear steps will help you in the long run:</p>
<ol type="1">
<li>Start with an outline of your formula’s business rules</li>
<li>In your script, hard-code key dollar amounts, weights, and ratios</li>
<li>Build code for your state’s base amount (or equivalent)</li>
<li>Build code for your state’s weighted funding (or equivalent)</li>
<li>Build code for direct funding streams</li>
<li>Calculate per-pupil amounts for comparison</li>
</ol>
</section>
<section id="step-1-create-an-outline-of-the-funding-formula-in-a-word-document-or-in-r" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="step-1-create-an-outline-of-the-funding-formula-in-a-word-document-or-in-r">Step 1: Create an outline of the funding formula in a word document or in R</h2>
<ul>
<li>Create business rules that will help with guiding the structure of the code and comments</li>
<li>Allows everyone to be on the same page about the data that is needed and how the various funding streams are calculated</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># funding formula table building --------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. BASE COST COMPONENT ------------</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1a) teacher base ------------</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1b) student support base ----------</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1c) district leadership and accountability component of base cost ----</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1d) building leader cost -------------</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1e) Athletics co-curricular costs -----------</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1f) local capacity percentage -----------------</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1g) local capacity amount  --------------</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. TARGETED ASSISTANCE ------------------</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. SPECIAL ED, ELL, CTE, DPIA CATEGORICALS ----------------------------</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. GIFTED FUNDING --------</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5. SUPPLEMENTAL TARGETED ASSSISTANCE -----------</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 6. TRANSPORTATION ---------------</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 7. CREATE TOTALS -----------</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-hard-code-in-the-per-pupil-base-weights-categoricals-and-cut-offs" class="level2">
<h2 class="anchored" data-anchor-id="step-2-hard-code-in-the-per-pupil-base-weights-categoricals-and-cut-offs">Step 2: Hard code in the per-pupil base, weights, categoricals, and cut-offs</h2>
<ul>
<li>Hardcoding in the variables protects against potential changes.
<ul>
<li>If a value changes, you just need to change the hard coded variable rather than going through the formula and changing all of the numbers associated with that variable.</li>
</ul></li>
<li>Needed for building run the impact of potential changes to weights, per-pupil base, and direct funding.</li>
</ul>
</section>
<section id="step-2-example-below-is-from-ohios-state-education-funding-formula-12" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="step-2-example-below-is-from-ohios-state-education-funding-formula-12">Step 2: Example below is from Ohio’s state education funding formula (1/2)</h2>
<div class="columns">
<div class="column" height="40%" style="width:40%;">
<p><strong>Greenbook - Teacher Base Cost</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/oh-greenbook-base.png" class="img-fluid figure-img" width="356"></p>
</figure>
</div>
</div><div class="column" height="40%" style="width:40%;">
<p><strong>R Code - Teacher Base Cost</strong></p>
<p>Note: I didn’t hard code in $9,953 for benefits because it’s 16% of the average teacher salary. Now, if the avg_teacher_salary changes, I don’t have to change the variable.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/oh-base-hardcode.png" class="img-fluid figure-img" width="271"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-2-example-below-is-from-ohios-state-education-funding-formula-22" class="level2">
<h2 class="anchored" data-anchor-id="step-2-example-below-is-from-ohios-state-education-funding-formula-22">Step 2: Example below is from Ohio’s state education funding formula (2/2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ohio Special education weights </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sped_1_weight <span class="ot">&lt;-</span> <span class="fl">0.2435</span> <span class="co"># speech and language impairments and intellectual disabilities </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>sped_2_weight <span class="ot">&lt;-</span> <span class="fl">0.6179</span> <span class="co"># specific learning disabilities and other health impaired </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#(minor) &amp; developmental delay (preschool only)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>sped_3_weight <span class="ot">&lt;-</span> <span class="fl">1.4845</span> <span class="co"># deafness, emotional disturbance </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>sped_4_weight <span class="ot">&lt;-</span> <span class="fl">1.9812</span> <span class="co"># visual impairments, other health impaired (other) </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>sped_5_weight <span class="ot">&lt;-</span> <span class="fl">2.6830</span> <span class="co"># multiple disabilities (other than deaf-blind), </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#orthopedic impairments, deaf-blindness</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>sped_6_weight <span class="ot">&lt;-</span> <span class="fl">3.9554</span> <span class="co"># autism and traumatic brain injury </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ohio English Learner weights </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>el_1_weight <span class="ot">&lt;-</span> .<span class="dv">2104</span> <span class="co"># Students identified as EL and enrolled in schools in the </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#US for 180 days or less</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>el_2_weight <span class="ot">&lt;-</span> .<span class="dv">1577</span> <span class="co"># Students identified as EL and enrolled in schools in the </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#US for more than 180 days until the student achieves EL proficiency </span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>el_3_weight <span class="ot">&lt;-</span> .<span class="dv">1053</span> <span class="co"># Students who achieved the proficient score on the EL exam </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-3-build-the-base-amount-in-r" class="level2">
<h2 class="anchored" data-anchor-id="step-3-build-the-base-amount-in-r">Step 3: Build the base amount in R</h2>
<p>The base amount will be the largest cost in a student-based formula. It reflects the cost of educating a single student and should be uniform across the state. However, sometimes base costs can be more complicated and involved multiple components.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/wsf-illustration.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="minnesota-example-calculate-the-base-amount-in-r" class="level2">
<h2 class="anchored" data-anchor-id="minnesota-example-calculate-the-base-amount-in-r">Minnesota Example: Calculate the base amount in R</h2>
<p>Calculating Minnesota’s per-pupil base amount is very straight forward:</p>
<ul>
<li><strong>Step 1</strong>: Hard coded the per-pupil base amount</li>
<li><strong>Step 2</strong>: Created the Minnesota data frame and created the base by multiplying the per-pupil base amount by total ADM</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the per-pupil base amount that is used for calculating the total base and then the weights </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>pp_mn_base <span class="ot">&lt;-</span> <span class="dv">6863</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the base amount</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>mn_base_funding_sch24 <span class="ot">&lt;-</span> formula_data24 <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>         <span class="co"># total base = school's total adm * 6863</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mn_base_total =</span> total_adm <span class="sc">*</span> pp_mn_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ohio-example-calculate-the-base-amount-for-charter-schools-in-r" class="level2">
<h2 class="anchored" data-anchor-id="ohio-example-calculate-the-base-amount-for-charter-schools-in-r">Ohio Example: Calculate the base amount for charter schools in R</h2>
<p>Calculating Ohio’s base amount is more complicated…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the formula data </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>charter_funding_formula <span class="ot">&lt;-</span> charter_formula_data <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. BASE COST COMPONENT ------------</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># | 1a) teacher base ------------</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">teacher_base_cost =</span> avg_teacher_salary <span class="sc">+</span> avg_health_insurance <span class="sc">+</span> (avg_teacher_salary <span class="sc">*</span> retirement_multiplier), </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">gr_k_classroom_teachers =</span> adm_k_fy22 <span class="sc">/</span> base_k_ratio, </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">gr_1_3_classroom_teachers =</span> adm_1_3_fy22 <span class="sc">/</span> base_1_3_ratio,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">gr_4_8_classroom_teachers =</span> adm_4_8_fy22 <span class="sc">/</span> base_4_8_ratio,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">gr_9_12_classroom_teachers =</span> adm_hs_fy2 <span class="sc">/</span> base_hs_ratio,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">cte_classroom_teachers =</span> adm_cte_fy22 <span class="sc">/</span> base_cte_ratio,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>       <span class="co"># sum total classroom teachers and cost</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">total_classroom_teachers =</span> gr_k_classroom_teachers <span class="sc">+</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>         gr_1_3_classroom_teachers <span class="sc">+</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>         gr_4_8_classroom_teachers <span class="sc">+</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>         gr_9_12_classroom_teachers <span class="sc">+</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>         cte_classroom_teachers,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">total_classroom_teachers_base_cost =</span> total_classroom_teachers <span class="sc">*</span> </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>         teacher_base_cost, </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>       <span class="co"># calculate total special teachers and cost </span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Community schools do not have a position minimum (6) for special education teachers </span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>       <span class="co"># like with traditional districts. Rather, it's the ADM divided by the ratio. </span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>       <span class="co"># When I was looking at the FY22 June CS Foundation Payment it used a different </span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>       <span class="co"># salary for special education teachers </span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">total_special_teachers =</span> total_adm_fy22<span class="sc">/</span>base_special_ratio,  </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">total_special_teachers_base_cost =</span> total_special_teachers <span class="sc">*</span> teacher_base_cost, </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>       <span class="co"># calculate sub costs</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">sub_teacher_base_cost =</span> (total_classroom_teachers <span class="sc">+</span> total_special_teachers) <span class="sc">*</span> </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>         ((sub_teacher_daily_rate <span class="sc">*</span> retirement_multiplier) <span class="sc">+</span> sub_teacher_daily_rate) <span class="sc">*</span> sub_teacher_days,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>       <span class="co"># calculate pd costs</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">teacher_pd_base_cost =</span> (total_classroom_teachers <span class="sc">+</span> total_special_teachers) <span class="sc">*</span> </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>         ((teacher_base_cost <span class="sc">-</span> avg_health_insurance) <span class="sc">/</span> <span class="dv">180</span>) <span class="sc">*</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>         teacher_pd_days,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>       <span class="co"># subtotal: teacher base cost </span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">total_teacher_component_base_cost =</span> total_classroom_teachers_base_cost <span class="sc">+</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>         total_special_teachers_base_cost <span class="sc">+</span> </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>         sub_teacher_base_cost <span class="sc">+</span> </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>         teacher_pd_base_cost,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">teacher_base_cost_formula =</span> ((total_classroom_teachers <span class="sc">+</span> total_special_teachers) <span class="sc">*</span> teacher_base_cost) <span class="sc">+</span> </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>         teacher_pd_base_cost <span class="sc">+</span> sub_teacher_base_cost) <span class="sc">|&gt;</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1b) student support base ----------</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co"># The student support base cost is a straight allocation for community schools ($874)</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">total_student_support_base_cost =</span> total_adm_fy22 <span class="sc">*</span> student_support_allocation) <span class="sc">|&gt;</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1c) district leadership and accountability component of base cost --------</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co"># The district leadership and accountability base cost is a straight allocation for community schools ($503)</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">total_district_leadership_base_cost =</span> total_adm_fy22 <span class="sc">*</span> district_leadership_allocation) <span class="sc">|&gt;</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  | 1d) building leader cost -------------</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="co"># The building leadership and operations base cost is a straight allocation for community schools ($1469)</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">total_building_leadership_base_cost =</span> total_adm_fy22 <span class="sc">*</span> building_leadership_allocation) <span class="sc">|&gt;</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | 1e) Athletics co-curricular costs -----------</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co"># The athletics base cost is a straight allocation for community schools ($163)</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">athletics_base_cost =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(athletic_eligible), <span class="dv">0</span>,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">case_when</span>(athletic_eligible <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> total_adm_fy22 <span class="sc">*</span> athletics_allocation,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>                                              athletic_eligible <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># | Aggregate base cost subtotal -----------</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">aggregate_base_cost =</span> total_teacher_component_base_cost <span class="sc">+</span> </span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>         total_student_support_base_cost <span class="sc">+</span> </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>         total_district_leadership_base_cost <span class="sc">+</span> </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>         total_building_leadership_base_cost <span class="sc">+</span> </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>         athletics_base_cost,</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>       <span class="at">aggregate_base_cost_pp =</span> aggregate_base_cost <span class="sc">/</span> total_adm_fy22) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4-build-the-weighted-funding-amounts" class="level2">
<h2 class="anchored" data-anchor-id="step-4-build-the-weighted-funding-amounts">Step 4: Build the weighted funding amounts</h2>
<p>The weights are additional funding for student groups with additional learning needs. Some formulas also have district-level adjustments to account for community conditions that affect costs, like sparsity or concentrated poverty.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/wsf-illustration.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="ohio-example-building-weighted-funding-for-special-education" class="level2">
<h2 class="anchored" data-anchor-id="ohio-example-building-weighted-funding-for-special-education">Ohio Example: Building weighted funding for special education</h2>
<p>Sometimes the weights can be straight forward. In Ohio, the special education is calculated as follows:</p>
<p><strong>special education category ADM x applicable weight x statewide average base cost per pupil</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the categorical funding amounts</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special education amounts </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># total amount = sped category * statewide avg. pp base * applicable weight </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sped_cat1_amt =</span> swd_cat1_fy22 <span class="sc">*</span> statewide_base_pp_cost <span class="sc">*</span> sped_1_weight,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sped_cat2_amt =</span> swd_cat2_fy22 <span class="sc">*</span> statewide_base_pp_cost <span class="sc">*</span> sped_2_weight,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sped_cat3_amt =</span> swd_cat3_fy22 <span class="sc">*</span> statewide_base_pp_cost <span class="sc">*</span> sped_3_weight,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">sped_cat4_amt =</span> swd_cat4_fy22 <span class="sc">*</span> statewide_base_pp_cost <span class="sc">*</span> sped_4_weight,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sped_cat5_amt =</span> swd_cat5_fy22 <span class="sc">*</span> statewide_base_pp_cost <span class="sc">*</span> sped_5_weight,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">sped_cat6_amt =</span> swd_cat6_fy22 <span class="sc">*</span> statewide_base_pp_cost <span class="sc">*</span> sped_6_weight) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="minnesota-example-building-weighted-funding-for-economically-disadvantaged-students" class="level2">
<h2 class="anchored" data-anchor-id="minnesota-example-building-weighted-funding-for-economically-disadvantaged-students">Minnesota Example: Building weighted funding for economically disadvantaged students</h2>
<p>Sometimes the weight calculations are more complicated!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mn-compensatory-rev.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="dont-panic-take-it-one-step-at-a-time" class="level2">
<h2 class="anchored" data-anchor-id="dont-panic-take-it-one-step-at-a-time">Don’t panic! Take it one step at a time!</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.thesmallbusinesssite.co.za/wp-content/uploads/2020/03/Panic-730x495.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="minnesota-example-compensatory-revenue-calculation-in-r" class="level2">
<h2 class="anchored" data-anchor-id="minnesota-example-compensatory-revenue-calculation-in-r">Minnesota Example: Compensatory Revenue Calculation in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Build the compensatory revenue formula with the mn_joined spreadsheet and graph it</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the compensatory revenue per school and rebuild the model</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>comprev_schools_model <span class="ot">&lt;-</span> mn_comprev_final <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 1: Split the reduced price student count in half because </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># they are only worth .5 in the compensatory revenue formula </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comprev_reduced_count =</span> reduced_lunch <span class="sc">*</span> .<span class="dv">5</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 2:Add together the .5 reduced price count to the free </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># count to get the corrected frpl number for the compensatory revenue formula </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">comprev_frpl_reduced_total =</span> comprev_reduced_count <span class="sc">+</span> free_lunch, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#This is the new frpl % with .5 reduced price count</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">comprev_frpl_reduced_pct =</span> comprev_frpl_reduced_total<span class="sc">/</span>enroll, </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Step 3: Divide by the weight factor by .8</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">comprev_weight_factor_step =</span> comprev_frpl_reduced_pct<span class="sc">/</span>.<span class="dv">8</span>, </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="do">### I'm keeping this interim step so that I can track it</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Replace anything above 1 with 1 because of the formula </span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">comprev_weight_factor =</span> <span class="fu">ifelse</span>(comprev_weight_factor_step <span class="sc">&gt;</span> <span class="dv">1</span>, </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="dv">1</span>, comprev_weight_factor_step), </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>         <span class="co"># determine the compensatory revenue pupil unit count </span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">comprev_comp_pupil_unit =</span> comprev_frpl_reduced_total<span class="sc">*</span>comprev_weight_factor<span class="sc">*</span>.<span class="dv">6</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># determine the amount of money that the school generates</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">comprev_total =</span> comprev_comp_pupil_unit <span class="sc">*</span> <span class="dv">5599</span>, </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># per-pupil amount for the school that generates the funds    </span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">comprev_pp =</span> comprev_total<span class="sc">/</span>frpl_total) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-5-build-in-direct-funding" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="step-5-build-in-direct-funding">Step 5: Build in direct funding</h2>
<p>Operates outside of the formula and does not go through the per-pupil base. Direct funding offers students additional educational opportunities by supporting programs that offer students learning opportunities beyond everyday classroom instruction.</p>
<ul>
<li>Math and reading programs</li>
<li>College and career readiness</li>
<li>Social-emotional learning</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/tn-direct-funding.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="alabama-example-direct-funding" class="level2">
<h2 class="anchored" data-anchor-id="alabama-example-direct-funding">Alabama Example: Direct Funding</h2>
<p>Just like with building weights, the direct funding can be straight forward.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alabama Classroom Instructional Support Funding -----</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>student_materials <span class="ot">&lt;-</span> <span class="dv">900</span> <span class="co"># multiply this by the total instructional unit</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>technology <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co"># multiply this by the total instructional unit</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>library_enhancement <span class="ot">&lt;-</span> <span class="fl">157.72</span> <span class="co"># multiply this by the total instructional unit</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>professional_development <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># multiply this by the total instructional unit</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>textbooks <span class="ot">&lt;-</span> <span class="dv">75</span> <span class="co"># multiply this by total student ADM </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Alabama Classroom Instructional Support Funding  calculations ------</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>al_direct_funding <span class="ot">&lt;-</span> formula_data24 <span class="sc">|&gt;</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># student materials funding </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">student_materials_amount =</span> student_materials <span class="sc">*</span> total_instructional_units, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># technology funding</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">technology_amount =</span> technology <span class="sc">*</span> total_instructional_units,  </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># library enhancement funding </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">library_enhacement_amount =</span> library_enhancement <span class="sc">*</span> total_instructional_units,  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># professional development funding </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">professional_development_amount =</span> professional_development <span class="sc">*</span> total_instructional_units,  </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># textbook funding </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">textbooks_amount =</span> textbooks <span class="sc">*</span> total_adm, </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># total classroom instructional support </span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_classroom_instructional_support =</span>  student_materials_amount <span class="sc">+</span> technology_amount <span class="sc">+</span> </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                            library_enhancement_amount <span class="sc">+</span> professional_development_amount </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">+</span> textbooks_amount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ohio-example-direct-funding" class="level2">
<h2 class="anchored" data-anchor-id="ohio-example-direct-funding">Ohio Example: Direct Funding</h2>
<p>Other times, the direct funding calculations can be more complicated.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/dpia-summary.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="dont-panic-one-step-at-a-time" class="level2">
<h2 class="anchored" data-anchor-id="dont-panic-one-step-at-a-time">Don’t panic! One step at a time!</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://sd.keepcalms.com/i/keep-calm-and-code-on-821.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="ohio-example-direct-funding-more-detail" class="level2">
<h2 class="anchored" data-anchor-id="ohio-example-direct-funding-more-detail">Ohio Example: Direct Funding, more detail</h2>
<p>You may need to consult multiple sets of documentation to uncover precise business rules for your state’s current funding system.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/dpia-detail.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="ohio-example-calculating-the-disadvantaged-pupil-impact-aid-12" class="level2">
<h2 class="anchored" data-anchor-id="ohio-example-calculating-the-disadvantaged-pupil-impact-aid-12">Ohio Example: Calculating the Disadvantaged Pupil Impact Aid (1/2)</h2>
<p><strong>Step 1</strong>: Find the calculation for the economically disadvantaged index:</p>
<p><em>District’s economically disadvantaged index = The square of (District’s economically disadvantaged percentage/Statewide economically disadvantaged percentage)</em></p>
<p><strong>Step 2:</strong> Translate that into R code</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/dpia-r-calc.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="ohio-example-calculating-the-disadvantaged-pupil-impact-aid-22" class="level2">
<h2 class="anchored" data-anchor-id="ohio-example-calculating-the-disadvantaged-pupil-impact-aid-22">Ohio Example: Calculating the Disadvantaged Pupil Impact Aid (2/2)</h2>
<p><strong>Step 3</strong>: Build out the Disadvantaged Pupil Impact Aid exception for e-schools in R</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/dpia-e-school.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="step-6-calculate-the-state-total-for-each-district-and-the-per-pupil-amount" class="level2">
<h2 class="anchored" data-anchor-id="step-6-calculate-the-state-total-for-each-district-and-the-per-pupil-amount">Step 6: Calculate the state total for each district and the per-pupil amount</h2>
<ul>
<li>To calculate the total, add together the base cost, the weights, and the direct funding</li>
<li>To calculate the per-pupil amount, divide the total funding by the total ADM</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Ohio charter funding total amount </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>charter_state_funding <span class="ot">&lt;-</span> charter_funding_formula <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_charter_adm =</span> <span class="fu">sum</span>(total_adm_fy22, <span class="at">na.rm =</span> T),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">state_base_cost =</span> <span class="fu">sum</span>(aggregate_base_cost, <span class="at">na.rm =</span> T),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">state_dpia_cost =</span> <span class="fu">sum</span>(econ_disadv_amt, <span class="at">na.rm =</span> T),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_econ_dis_adm =</span> <span class="fu">sum</span>(econ_dis_adm_fy22, <span class="at">na.rm =</span> T),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">state_el_cost =</span> <span class="fu">sum</span>(ell_funding, <span class="at">na.rm =</span> T),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">state_sped_cost =</span> <span class="fu">sum</span>(special_ed_funding, <span class="at">narm =</span> T),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">state_cte_cost =</span> <span class="fu">sum</span>(cte_funding, <span class="at">na.rm =</span> T)) <span class="sc">|&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_base_pp =</span> state_base_cost<span class="sc">/</span>total_charter_adm, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">econ_dis_pp =</span> state_dpia_cost<span class="sc">/</span>total_econ_dis_adm,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">econ_dis_pp_second =</span> state_dpia_cost<span class="sc">/</span>total_charter_adm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="why-are-per-pupil-amounts-important" class="level2">
<h2 class="anchored" data-anchor-id="why-are-per-pupil-amounts-important">Why are per-pupil amounts important?</h2>
<p>Per-pupil amounts are important to identify if funding formulas are equitably distributing funds</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/per-pupil-before-after.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="small-group-activity" class="level1">
<h1>Small group activity</h1>
<section id="building-a-funding-formula-in-r" class="level2">
<h2 class="anchored" data-anchor-id="building-a-funding-formula-in-r">Building a funding formula in R</h2>
<p>Your team has been tasked with building your state’s newly passed funding formula in R. Using the information in the table, hard code in the base, weights, and direct funding and then write out the R code that would be used to model the formula. Be sure to include headings and comments!!!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.memesmonkey.com/images/memesmonkey/1c/1c00a56795e6846cd7a57d9a63294be1.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="homework" class="level1 smaller">
<h1 class="smaller">Homework</h1>
<p><strong>Reading</strong></p>
<ul>
<li><a href="https://bellwether.org/publications/priced-out/">Priced Out of Public Schools: District Lines, Housing Access, and Inequitable Educational Options</a></li>
</ul>
<p><strong>Coding task</strong></p>
<p>Start building a version of your state’s funding formula in R! If you still have data cleaning work outstanding, please prioritize that this week. Once you <em>do</em> have clean data, start building out your state’s formula. Follow the steps we outlined in class, take it slow, and be sure to keep your code organized and commented well.</p>
<ul>
<li>Please be sure to add a <code>data</code> folder with a copy of the clean state data you created.</li>
<li>As always, once you’ve completed the assignment, be sure to commit and push to GitHub! (make sure the data your formula uses is also committed and pushed)</li>
</ul>


</section>

</main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>